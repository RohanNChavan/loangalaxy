<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>LoanGalaxy - Your Trusted Loan Marketplace</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display:ital@0;1&family=Work+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="styles.css">
</head>
<body>

<!-- ALL YOUR HTML CONTENT ABOVE REMAINS EXACTLY SAME -->
<!-- (I am skipping repeating unchanged sections to keep this readable) -->

<script>
/* EMI Calculator (unchanged) */
const loanAmountInput = document.getElementById('loanAmount');
const interestRateInput = document.getElementById('interestRate');
const loanTenureInput = document.getElementById('loanTenure');

const loanAmountValue = document.getElementById('loanAmountValue');
const interestRateValue = document.getElementById('interestRateValue');
const loanTenureValue = document.getElementById('loanTenureValue');

const emiResult = document.getElementById('emiResult');
const totalInterest = document.getElementById('totalInterest');
const totalAmount = document.getElementById('totalAmount');

function formatNumber(num) {
    return num.toLocaleString('en-IN');
}

function calculateEMI() {
    const principal = parseFloat(loanAmountInput.value);
    const rate = parseFloat(interestRateInput.value) / 12 / 100;
    const tenure = parseFloat(loanTenureInput.value) * 12;

    const emi = principal * rate * Math.pow(1 + rate, tenure) / (Math.pow(1 + rate, tenure) - 1);
    const total = emi * tenure;
    const interest = total - principal;

    loanAmountValue.textContent = formatNumber(principal);
    interestRateValue.textContent = parseFloat(interestRateInput.value).toFixed(1);
    loanTenureValue.textContent = loanTenureInput.value;

    emiResult.textContent = formatNumber(Math.round(emi));
    totalInterest.textContent = formatNumber(Math.round(interest));
    totalAmount.textContent = formatNumber(Math.round(total));
}

loanAmountInput.addEventListener('input', calculateEMI);
interestRateInput.addEventListener('input', calculateEMI);
loanTenureInput.addEventListener('input', calculateEMI);
calculateEMI();

/* ========================= */
/* MULTI STEP FORM (UPDATED) */
/* ========================= */

let currentStep = 1;

function nextStep(step) {

    const currentStepElement = document.getElementById('step' + currentStep);
    const inputs = currentStepElement.querySelectorAll("input, select");

    for (let input of inputs) {
        if (!input.checkValidity()) {
            input.reportValidity();
            return;
        }
    }

    currentStepElement.classList.remove('active');

    document.querySelectorAll('.progress-step')[currentStep - 1].classList.add('completed');
    document.querySelectorAll('.progress-step')[currentStep - 1].classList.remove('active');

    currentStep = step;
    document.getElementById('step' + currentStep).classList.add('active');
    document.querySelectorAll('.progress-step')[currentStep - 1].classList.add('active');

    document.querySelector('.application-form')
        .scrollIntoView({ behavior: 'smooth', block: 'start' });
}

function prevStep(step) {

    document.getElementById('step' + currentStep).classList.remove('active');

    document.querySelectorAll('.progress-step')[currentStep - 1].classList.remove('active');
    document.querySelectorAll('.progress-step')[step - 1].classList.remove('completed');

    currentStep = step;
    document.getElementById('step' + currentStep).classList.add('active');
    document.querySelectorAll('.progress-step')[currentStep - 1].classList.add('active');

    document.querySelector('.application-form')
        .scrollIntoView({ behavior: 'smooth', block: 'start' });
}

/* ========================= */
/* SUBMIT WITH VALIDATION    */
/* ========================= */

async function submitApplication() {

    const currentStepElement = document.getElementById('step3');
    const inputs = currentStepElement.querySelectorAll("input, select");

    for (let input of inputs) {
        if (!input.checkValidity()) {
            input.reportValidity();
            return;
        }
    }

    const data = {
        loanType: document.querySelector('#step1 select').value,
        loanAmount: document.querySelector('#step1 input[type="number"]').value,
        fullName: document.querySelector('input[placeholder="Enter full name as per PAN"]').value,
        email: document.querySelector('input[type="email"]').value,
        mobile: document.querySelector('input[type="tel"]').value,
        employmentType: document.getElementById('employmentType').value,
        monthlyIncome: document.getElementById('monthlyIncome').value
    };

    try {
        const response = await fetch("https://e0e7lhxbeb.execute-api.ap-south-1.amazonaws.com/prod/submit", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(data)
        });

        const result = await response.json();

        if (response.ok) {

            alert('Thank you for your application! Our team will review it and contact you within 24 hours.\n\nApplication ID: ' + result.applicationId);

            document.querySelectorAll('.application-form input, .application-form select')
                .forEach(el => el.value = "");

            document.getElementById('step3').classList.remove('active');
            document.getElementById('step1').classList.add('active');

            document.querySelectorAll('.progress-step').forEach(step => {
                step.classList.remove('completed', 'active');
            });

            document.querySelectorAll('.progress-step')[0].classList.add('active');
            currentStep = 1;

        } else {
            alert("Something went wrong. Please try again.");
        }

    } catch (error) {
        alert("Server error. Please try again.");
        console.error(error);
    }
}

/* Smooth Scroll (unchanged) */
document.querySelectorAll('a[href^="#"]').forEach(anchor => {
    anchor.addEventListener('click', function (e) {
        e.preventDefault();
        const target = document.querySelector(this.getAttribute('href'));
        if (target) {
            target.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }
    });
});
</script>

</body>
</html>
